<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>장보기 목록</title>
    <link rel="stylesheet" type="text/css" href="./css/shoppingCss.css" />
  </head>
  <body>
    <div class="container" id="container">
      <div class="title">
        <strong>장보기 목록 입니다.</strong>
      </div>
      <div class="container_inputbox">
        <label for="nameId">이름 </label
        ><input type="text" id="nameId" class="inputbox_inputitem" />
        <label for="quantityId">수량 </label
        ><input type="number" id="quantityId" class="inputbox_inputitem" />
        <label for="priceId">가격 </label
        ><input type="number" id="priceId" class="inputbox_inputitem" />
        <label for="priorityId">우선순위 </label>
        <input type="number" id="priorityId" class="inputbox_inputitem" />
        <button class="container_addButton">add</button>
      </div>
      <div class="container_select">
        <select id="sortSelect">
          <option value="" selected disabled>정렬순서</option>
          <option value="name">이름</option>
          <option value="quantity">수량</option>
          <option value="price">가격</option>
          <option value="priority">우선순위</option>
        </select>
      </div>
      <div class="renderContainer">
        <table class="renderHead">
          <thead>
            <tr>
              <th>이름</th>
              <th>수량</th>
              <th>가격</th>
              <th>우선순위</th>
              <th>삭제</th>
            </tr>
          </thead>
          <tbody class="renderInput"></tbody>
        </table>
        <div>
          <label>계: </label><label class="sumPrice">0</label><label>원</label>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      class Shopping {
        constructor(id) {
          this.shopping = [];
          this.prices = "0";
          this.$shoppingList = document.querySelector(id);
          this.initializeEvents();
        }

        initializeEvents() {
          const $add = this.$shoppingList.querySelector(".container_addButton");
          $add.addEventListener("click", this.handleClickAdd);
          const $delete = this.$shoppingList.querySelector(".renderInput");
          $delete.addEventListener("click", this.handleClickDelete);
          const $select = this.$shoppingList.querySelector("#sortSelect");
          $select.addEventListener("change", this.changeSelect);
        }

        setShopping(shopping) {
          this.shopping = shopping;
          this.changeSelect();
          this.renderList();
        }

        handleClickAdd = () => {
          const $inputName = this.$shoppingList.querySelector("#nameId");
          const $inputQuantity =
            this.$shoppingList.querySelector("#quantityId");
          const $inputPrice = this.$shoppingList.querySelector("#priceId");
          const $inputPriority =
            this.$shoppingList.querySelector("#priorityId");
          if (
            $inputName.value.length === 0 ||
            $inputPrice.value.length === 0 ||
            $inputQuantity.value.length === 0
          ) {
            return;
          }
          this.priceSum(
            parseInt(this.prices, 10) + parseInt($inputPrice.value, 10),
          );

          this.setShopping([
            ...this.shopping,
            {
              id: Date.now(),
              name: $inputName.value,
              quantity: $inputQuantity.value,
              price: $inputPrice.value,
              priority: $inputPriority.value,
            },
          ]);
          $inputName.value = "";
          $inputPrice.value = "";
          $inputPriority.value = "";
          $inputQuantity.value = "";
        };

        handleClickDelete = (event) => {
          const { target } = event;
          const targetId = target.getAttribute("data-id");
          if (!target.classList.contains("deleteBtn")) {
            return;
          }
          this.priceSubmit(targetId);
          this.setShopping(
            this.shopping.filter(
              (shopping) => shopping.id !== parseInt(target.dataset.id, 10),
            ),
          );
        };

        priceSubmit(targetId) {
          const $pricesSum = document.querySelector(".sumPrice");
          const submitPrice = this.shopping.find(
            (shopping) => shopping.id === parseInt(targetId),
          );
          this.prices -= submitPrice.price;
          $pricesSum.innerHTML = this.prices;
        }

        renderList() {
          const $list = this.$shoppingList.querySelector(".renderInput");
          $list.innerHTML = this.shopping
            .map(
              (shopping) =>
                `<tr><td>${shopping.name}</td><td>${shopping.quantity}</td><td>${shopping.price}</td><td>${shopping.priority}</td><td><button class='deleteBtn' data-id='${shopping.id}'>b</button></td></tr>`,
            )
            .join("");
        }

        priceSum(price) {
          const $pricesSum = document.querySelector(".sumPrice");
          this.prices = price;
          $pricesSum.innerHTML = this.prices;
        }

        changeSelect = (event) => {
          const $selectChange = document.querySelector("#sortSelect");
          const $selectValue =
            $selectChange.options[$selectChange.selectedIndex].value;
          if ($selectValue === "name") {
            this.shopping.sort(function (a, b) {
              return a.name < b.name ? -1 : a.name > b.name ? 1 : 0;
            });
          }
          if ($selectValue === "quantity") {
            this.shopping.sort(function (a, b) {
              return a.quantity - b.quantity;
            });
          }
          if ($selectValue === "price") {
            this.shopping.sort(function (a, b) {
              return a.price - b.price;
            });
          }
          if ($selectValue === "priority") {
            this.shopping.sort(function (a, b) {
              console.log(a);
              console.log(b);
              if (a === "") {
                return 1;
              }
              if (b === "") {
                return -1;
              }
              return a.priority - b.priority;
            });
          }
          this.renderList();
        };
      }
      const shopping = new Shopping("#container");
    </script>
  </body>
</html>
